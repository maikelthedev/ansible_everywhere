- name: Configure all systems
  hosts: all
  become: true
  gather_facts: true
  pre_tasks:
    - name: Set vault token from env
      set_fact:
        vault_token: "{{ lookup('env','LOCAL_VAULT_ROOT_TOKEN') }}"
        vault_addr: "{{ lookup('env','LOCAL_VAULT_ADDR') }}"
  tasks:
    - name: Debug OS info
      debug:
        msg: "Running on {{ ansible_os_family }} ({{ inventory_hostname }})"

    - name: Include FreeBSD-specific tasks
      include_role:
        name: freebsd
      when: ansible_os_family == "FreeBSD"

    - name: Include Arch-specific tasks
      include_role:
        name: arch
      when: ansible_distribution == "Archlinux"

    - name: Include NixOS-specific tasks
      include_role:
        name: nixos
      when: ansible_distribution == "NixOS"